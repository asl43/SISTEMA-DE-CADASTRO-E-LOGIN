<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sistema - Cadastro / Login (CPF)</title>
  <style>
    :root{--bg:#f3f6fb;--card:#ffffff;--accent:#0b74de;--muted:#6b7280}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:var(--bg); margin:0; padding:20px; display:flex; align-items:center; justify-content:center; min-height:100vh}
    .card{background:var(--card); width:100%; max-width:520px; padding:22px; border-radius:12px; box-shadow:0 6px 18px rgba(11,20,40,0.08)}
    h1{margin:0 0 12px;font-size:20px}
    p.lead{color:var(--muted); margin:0 0 18px}
    form{display:grid; gap:10px}
    input, button, select{padding:10px 12px; font-size:14px; border:1px solid #e6e9ef; border-radius:8px}
    .row{display:flex; gap:10px}
    .small{flex:1}
    .actions{display:flex; gap:10px; margin-top:8px}
    button{cursor:pointer; border:none; background:var(--accent); color:#fff}
    .muted{color:var(--muted); font-size:13px}
    .hidden{display:none}
    .success{background:#ecfdf5; color:#065f46; padding:10px; border-radius:8px}
  </style>
</head>
<body>
  <div class="card" id="app">
    <h1>Cadastro / Login</h1>
    <p class="lead">Cadastre-se com nome, CPF, e-mail, data de nascimento e telefone — ou faça login pelo CPF.</p>

    <div id="screens">
      <!-- Tela inicial: escolher cadastro ou login -->
      <div id="homeScreen">
        <button id="btnShowRegister">Criar conta (Cadastro)</button>
        <button id="btnShowLogin" style="background:#e6e9ef;color:#0b1220">Entrar (Login)</button>
        <p class="muted" style="margin-top:12px">Integração: Apps Script. Substitua <code>ENDPOINT_URL</code> no código pelo URL do seu Web App.</p>
      </div>

      <!-- Formulário de cadastro -->
      <div id="registerScreen" class="hidden">
        <form id="registerForm">
          <input type="text" id="nome" placeholder="Nome completo" required />
          <input type="text" id="cpf" placeholder="CPF" maxlength="14" required />
          <input type="email" id="email" placeholder="E-mail" required />
          <div class="row">
            <input type="date" id="nascimento" class="small" placeholder="Data de nascimento" required />
            <input type="tel" id="telefone" class="small" placeholder="Telefone" maxlength="15" required />
          </div>
          <div class="actions">
            <button type="submit">Registrar</button>
            <button type="button" id="btnBackFromRegister" style="background:#e6e9ef;color:#0b1220">Voltar</button>
          </div>
        </form>
        <div id="registerMsg" class="muted" style="margin-top:8px"></div>
      </div>

      <!-- Tela de login -->
      <div id="loginScreen" class="hidden">
        <form id="loginForm">
          <input type="text" id="loginCpf" placeholder="Digite seu CPF" maxlength="14" required />
          <div class="actions">
            <button type="submit">Entrar</button>
            <button type="button" id="btnBackFromLogin" style="background:#e6e9ef;color:#0b1220">Voltar</button>
          </div>
        </form>
        <div id="loginMsg" class="muted" style="margin-top:8px"></div>
      </div>

      <!-- Dashboard simples após login -->
      <div id="dashboardScreen" class="hidden">
        <div id="welcome" style="margin-bottom:12px"></div>
        <div class="success hidden" id="welcomeData"></div>
        <button id="btnLogout" style="background:#ef4444">Sair</button>
      </div>
    </div>

  </div>

<script>
// ======== CONFIGURE AQUI ========
const APPS_SCRIPT_URL = 'ENDPOINT_URL'; // <-- Substitua pelo seu URL do Web App (Apps Script) publicado
// O Apps Script deve aceitar:
//  - POST para registrar: POST ?action=register  com JSON {nome, cpf, email, nascimento, telefone}
//  - GET para checar CPF:  GET ?action=check&cpf=...  retornando JSON {found: true/false, data: {...}}
// Ex.: GET https://script.google.com/macros/s/ABCDE/exec?action=check&cpf=12345678901
// =================================

// Utilitários de máscara simples
function onlyDigits(str){return str.replace(/\D/g,'')}
function formatCPF(v){v=onlyDigits(v).slice(0,11); if(v.length<=3) return v; if(v.length<=6) return v.slice(0,3)+'.'+v.slice(3); if(v.length<=9) return v.slice(0,3)+'.'+v.slice(3,6)+'.'+v.slice(6); return v.slice(0,3)+'.'+v.slice(3,6)+'.'+v.slice(6,9)+'-'+v.slice(9)}
function formatPhone(v){v=onlyDigits(v).slice(0,11); if(v.length<=2) return v; if(v.length<=7) return '('+v.slice(0,2)+') '+v.slice(2); return '('+v.slice(0,2)+') '+v.slice(2,7)+'-'+v.slice(7)}

// Elements
const homeScreen = document.getElementById('homeScreen');
const registerScreen = document.getElementById('registerScreen');
const loginScreen = document.getElementById('loginScreen');
const dashboardScreen = document.getElementById('dashboardScreen');

// Buttons
document.getElementById('btnShowRegister').onclick = ()=> show('register')
document.getElementById('btnShowLogin').onclick = ()=> show('login')
document.getElementById('btnBackFromRegister').onclick = ()=> show('home')
document.getElementById('btnBackFromLogin').onclick = ()=> show('home')

// Forms
const registerForm = document.getElementById('registerForm');
const loginForm = document.getElementById('loginForm');

// Inputs
const cpfInput = document.getElementById('cpf');
const telInput = document.getElementById('telefone');
const loginCpfInput = document.getElementById('loginCpf');

cpfInput.addEventListener('input', e=>{ e.target.value = formatCPF(e.target.value) })
telInput.addEventListener('input', e=>{ e.target.value = formatPhone(e.target.value) })
loginCpfInput.addEventListener('input', e=>{ e.target.value = formatCPF(e.target.value) })

function show(screen){ homeScreen.classList.add('hidden'); registerScreen.classList.add('hidden'); loginScreen.classList.add('hidden'); dashboardScreen.classList.add('hidden');
  if(screen==='home') homeScreen.classList.remove('hidden');
  if(screen==='register') registerScreen.classList.remove('hidden');
  if(screen==='login') loginScreen.classList.remove('hidden');
  if(screen==='dashboard') dashboardScreen.classList.remove('hidden');
}

// Basic client-side CPF validation (length only)
function cleanCPF(v){return onlyDigits(v)}
function isCPFValid(v){ const s = cleanCPF(v); return s.length===11 }

// ---------- Register ----------
registerForm.addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  const nome = document.getElementById('nome').value.trim();
  const cpf = cleanCPF(document.getElementById('cpf').value);
  const email = document.getElementById('email').value.trim();
  const nascimento = document.getElementById('nascimento').value;
  const telefone = document.getElementById('telefone').value.trim();
  const msg = document.getElementById('registerMsg');
  msg.textContent = '';

  if(!isCPFValid(cpf)){ msg.textContent = 'CPF inválido. Deve ter 11 dígitos.'; return }
  if(!nome || !email || !nascimento || !telefone){ msg.textContent = 'Preencha todos os campos.'; return }

  // Envia para Apps Script
  try{
    const res = await fetch(APPS_SCRIPT_URL + '?action=register', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({nome, cpf, email, nascimento, telefone})
    });
    const j = await res.json();
    if(j && j.success){ msg.textContent = 'Cadastro realizado com sucesso! Agora faça login.'; msg.style.color = 'green';
      // voltar pro login automaticamente
      setTimeout(()=>{ show('login'); }, 900);
    } else {
      msg.textContent = j && j.error ? ('Erro: '+j.error) : 'Erro ao registrar.';
      msg.style.color = 'red';
    }
  }catch(err){ console.error(err); msg.textContent = 'Falha ao conectar com Apps Script. Verifique a URL.'; msg.style.color = 'red' }
});

// ---------- Login ----------
loginForm.addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  const cpf = cleanCPF(document.getElementById('loginCpf').value);
  const msg = document.getElementById('loginMsg'); msg.textContent = '';
  if(!isCPFValid(cpf)){ msg.textContent = 'CPF inválido.'; return }

  try{
    const url = APPS_SCRIPT_URL + '?action=check&cpf=' + encodeURIComponent(cpf);
    const res = await fetch(url);
    const j = await res.json();
    if(j && j.found){ // login OK
      show('dashboard');
      const welcome = document.getElementById('welcome');
      welcome.textContent = `Bem-vindo(a), ${j.data.nome}`;
      const welcomeData = document.getElementById('welcomeData');
      welcomeData.classList.remove('hidden');
      welcomeData.textContent = `CPF: ${formatCPF(j.data.cpf)} — E-mail: ${j.data.email} — Nascimento: ${j.data.nascimento} — Telefone: ${j.data.telefone}`;
    } else {
      msg.textContent = 'CPF não encontrado. Verifique ou faça o cadastro.';
    }
  }catch(err){ console.error(err); msg.textContent = 'Erro ao consultar Apps Script. Verifique a URL e se o Web App está publicado.' }
});

// Logout
document.getElementById('btnLogout').addEventListener('click', ()=>{ show('home') })

// Inicializa
show('home')
</script>
</body>
</html>
